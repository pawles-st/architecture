#!/bin/bash

h=$(tput cols)
w=$(tput lines)

declare -A WALLS=("1,1"   1 "2,1"   1 "3,1"   1 "4,1"   1 "5,1"   1 "6,1"   1 "7,1"   1 "8,1"   1 "9,1"   1 "10,1"  1 "11,1"  1 "12,1"  1 "13,1"  1 "14,1"  1 "15,1"  1 "16,1"  1 "17,1"  1 "18,1"  1 "19,1"  1 "20,1"  1 \
                  "1,2"   1                                                                                                     "12,2"  1                                                                       "20,2"  1 \
                  "1,3"   1           "3,3"   1 "4,3"   1 "5,3"   1 "6,3"   1 "7,3"   1           "9,3"   1           "11,3"  1 "12,3"  1           "14,3"  1 "15,3"  1 "16,3"  1 "17,3"  1 "18,3"  1           "20,3"  1 \
                  "1,4"   1           "3,4"   1                               "7,4"   1           "9,4"   1                     "12,4"  1           "14,4"  1                               "18,4"  1           "20,4"  1 \
                  "1,5"   1           "3,5"   1                               "7,5"   1           "9,5"   1 "10,5"  1           "12,5"  1                                                   "18,5"  1           "20,5"  1 \
                  "1,6"   1           "3,6"   1                               "7,6"   1           "9,6"   1                     "12,6"  1           "14,6"  1                               "18,6"  1           "20,6"  1 \
                  "1,7"   1           "3,7"   1 "4,7"   1           "6,7"   1 "7,7"   1           "9,7"   1           "11,7"  1 "12,7"  1           "14,7"  1 "15,7"  1 "16,7"  1 "17,7"  1 "18,7"  1           "20,7"  1 \
                  "1,8"   1                                                                       "9,8"   1                     "12,8"  1                                                                       "20,8"  1 \
                  "1,9"   1 "2,9"   1 "3,9"   1 "4,9"   1 "5,9"   1 "6,9"   1 "7,9"   1           "9,9"   1 "10,9"  1                               "14,9"  1 "15,9"  1 "16,9"  1 "17,9"  1 "18,9"  1           "20,9"  1 \
                  "1,10"  1           "3,10"  1                               "7,10"  1           "9,10"  1                     "12,10" 1                               "16,10" 1                               "20,10" 1 \
                  "1,11"  1                               "5,11"  1                               "9,11"  1                     "12,11" 1           "14,11" 1                               "18,11" 1           "20,11" 1 \
                  "1,12"  1           "3,12"  1 "4,12"  1 "5,12"  1 "6,12"  1 "7,12"  1                               "11,12" 1 "12,12" 1           "14,12" 1 "15,12" 1 "16,12" 1 "17,12" 1 "18,12" 1 "19,12" 1 "20,12" 1 \
                  "1,13"  1                                                                       "9,13"  1                     "12,13" 1                                                                       "20,13" 1 \
                  "1,14"  1           "3,14"  1 "4,14"  1 "5,14"  1 "6,14"  1 "7,14"  1           "9,14"  1 "10,14" 1           "12,14" 1           "14,14" 1 "15,14" 1           "17,14" 1 "18,14" 1           "20,14" 1 \
                  "1,15"  1           "3,15"  1                               "7,15"  1           "9,15"  1                     "12,15" 1           "14,15" 1                               "18,15" 1           "20,15" 1 \
                  "1,16"  1           "3,16"  1                                                   "9,16"  1           "11,16" 1 "12,16" 1           "14,16" 1                               "18,16" 1           "20,16" 1 \
                  "1,17"  1           "3,17"  1                               "7,17"  1           "9,17"  1                     "12,17" 1           "14,17" 1                               "18,17" 1           "20,17" 1 \
                  "1,18"  1           "3,18"  1 "4,18"  1 "5,18"  1 "6,18"  1 "7,18"  1           "9,18"  1 "10,18" 1           "12,18" 1           "14,18" 1 "15,18" 1 "16,18" 1 "17,18" 1 "18,18" 1           "20,18" 1 \
                  "1,19"  1                                                                       "9,19"  1                                                                                                     "20,19" 1 \
                  "1,20"  1 "2,20"  1 "3,20"  1 "4,20"  1 "5,20"  1 "6,20"  1 "7,20"  1 "8,20"  1 "9,20"  1 "10,20" 1 "11,20" 1 "12,20" 1 "13,20" 1 "14,20" 1 "15,20" 1 "16,20" 1 "17,20" 1 "18,20" 1 "19,20" 1 "20,20" 1)

pos_x=15
pos_y=15
vel=1
direction='k' # controls : hjkl 

pacman='@'
wall='#'
pellet='Â·'
#ghost='0'

tput civis
tput clear

# draw walls

for x in {1..20}
do
	for y in {1..20}
	do
		coord="${x},${y}"
		if [ "${WALLS[$coord]}" == "1" ]
		then
			echo -en "\033[${y};${x}H$wall"
		else
			echo -en "\033[${y};${x}H$pellet"
		fi
	done
done

# draw pellets



# function that moves pacman in current direction by $1 * speed

move() {
	case "$direction" in
		[h] ) (( pos_x -= $1 * vel ));;
		[j] ) (( pos_y += $1 * vel ));;
		[k] ) (( pos_y -= $1 * vel ));;
		[l] ) (( pos_x += $1 * vel ));;
	esac	
}

# run the game

while [[ $q != q ]]
do

	# hide pacman

	echo -en "\033[${pos_y};${pos_x}H "

	# move pacman

	move 1

	# verify pacman position

	pos="${pos_x},${pos_y}"
	if [ "${WALLS[$pos]}" == '1' ]
	then
		move -1
	fi

	# eat pellet and show pacman

	echo -en "\033[${pos_y};${pos_x}H$pacman"

	# read input

	read -n 1 -s -t 0.1 q
	case "$q" in
		[hH] ) direction='h';;
		[jJ] ) direction='j';;
		[kK] ) direction='k';;
		[lL] ) direction='l';;
	esac
done

tput cnorm
